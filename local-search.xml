<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ubuntu18.04 修改mysql的存储目录踩坑</title>
    <link href="/2020/08/11/ubuntu18-04-%E4%BF%AE%E6%94%B9mysql%E7%9A%84%E5%AD%98%E5%82%A8%E7%9B%AE%E5%BD%95%E8%B8%A9%E5%9D%91/"/>
    <url>/2020/08/11/ubuntu18-04-%E4%BF%AE%E6%94%B9mysql%E7%9A%84%E5%AD%98%E5%82%A8%E7%9B%AE%E5%BD%95%E8%B8%A9%E5%9D%91/</url>
    
    <content type="html"><![CDATA[<h6 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h6> <pre><code class="hljs angelscript">系统： ubuntu18<span class="hljs-number">.04</span>mysql：<span class="hljs-number">5.7</span><span class="hljs-number">.31</span></code></pre><p>正常情况下，修改存储目录只需要拷贝数据和授权即可，但是发现就是不行(各种权限问题等)，后来发现是apparmor导致的，这个是ubuntu系统默认开启的。</p><pre><code class="hljs sql">2020-08-10T08:10:07.460723Z 0 [Warning] Can&#x27;t <span class="hljs-keyword">create</span> <span class="hljs-keyword">test</span> <span class="hljs-keyword">file</span> /<span class="hljs-keyword">data</span>/mysql_data/<span class="hljs-number">145.</span><span class="hljs-keyword">lower</span>-<span class="hljs-keyword">test</span>mysqld: <span class="hljs-keyword">File</span> <span class="hljs-string">&#x27;/data/mysql_bin_log/mysql-bin.index&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">found</span> (Errcode: <span class="hljs-number">13</span> - Permission denied) </code></pre><h6 id="apparmor"><a href="#apparmor" class="headerlink" title="apparmor"></a>apparmor</h6> <pre><code class="hljs plain">AppArmor是一个高效和易于使用的Linux系统安全应用程序AppArmor对操作系统和应用程序所受到的威胁进行从内到外的保护</code></pre><h6 id="apparmor的工作模式"><a href="#apparmor的工作模式" class="headerlink" title="apparmor的工作模式"></a>apparmor的工作模式</h6><pre><code class="hljs properties"><span class="hljs-attr">apparmor有两种工作模式，enforcement和complain</span><span class="hljs-attr">enforcement</span> <span class="hljs-string">模式下，应用将严格遵循配置文件里列出的限制条件，未被授权的访问将被拒绝。</span><span class="hljs-attr">complain模式下，如果应用违反了配置文件里的限制条件，apparmor只是对程序的行为进行记录，不会拒绝访问。</span></code></pre><h6 id="使用statua命令查看apparmor的运行状态"><a href="#使用statua命令查看apparmor的运行状态" class="headerlink" title="使用statua命令查看apparmor的运行状态"></a>使用statua命令查看apparmor的运行状态</h6><pre><code class="hljs gradle">sudo apparmor_statusapparmor module is loaded.<span class="hljs-number">13</span> profiles are loaded.<span class="hljs-number">13</span> profiles are in enforce mode.   <span class="hljs-regexp">/sbin/</span>dhclient   <span class="hljs-regexp">/usr/</span>bin/man   <span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/NetworkManager/</span>nm-dhcp-client.action   <span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/NetworkManager/</span>nm-dhcp-helper   <span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/connman/</span>scripts/dhclient-script   <span class="hljs-regexp">/usr/</span>sbin/chronyd   <span class="hljs-regexp">/usr/</span>sbin/mysqld   <span class="hljs-regexp">/usr/</span>sbin/ntpd   <span class="hljs-regexp">/usr/</span>sbin/slapd   <span class="hljs-regexp">/usr/</span>sbin/tcpdump   docker-<span class="hljs-keyword">default</span>   man_filter   man_groff<span class="hljs-number">0</span> profiles are in complain mode.<span class="hljs-number">3</span> processes have profiles defined.<span class="hljs-number">3</span> processes are in enforce mode.   <span class="hljs-regexp">/usr/</span>sbin/chronyd (<span class="hljs-number">568</span>)   <span class="hljs-regexp">/usr/</span>sbin/mysqld (<span class="hljs-number">4136</span>)   <span class="hljs-regexp">/usr/</span>sbin/slapd (<span class="hljs-number">12073</span>)<span class="hljs-number">0</span> processes are in complain mode.<span class="hljs-number">0</span> processes are unconfined but have a profile defined.</code></pre><h6 id="由上述发现mysql是enforce状态的，这就是为什么你修改目录权限啥都不生效的原因"><a href="#由上述发现mysql是enforce状态的，这就是为什么你修改目录权限啥都不生效的原因" class="headerlink" title="由上述发现mysql是enforce状态的，这就是为什么你修改目录权限啥都不生效的原因"></a>由上述发现mysql是enforce状态的，这就是为什么你修改目录权限啥都不生效的原因</h6><h6 id="安装方便操作apparmor的工具"><a href="#安装方便操作apparmor的工具" class="headerlink" title="安装方便操作apparmor的工具"></a>安装方便操作apparmor的工具</h6><p>sudo apt-get install  apparmor-utils</p><h6 id="修改mysql为complain模式"><a href="#修改mysql为complain模式" class="headerlink" title="修改mysql为complain模式"></a>修改mysql为complain模式</h6><p>aa-complain  /usr/sbin/mysqld </p><h6 id="重启apparmor"><a href="#重启apparmor" class="headerlink" title="重启apparmor"></a>重启apparmor</h6><p>/etc/init.d/apparmor restart</p><p>再去启动mysql一切正常。。。。。。</p>]]></content>
    
    
    <categories>
      
      <category>mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mysql</tag>
      
      <tag>ubuntu</tag>
      
      <tag>apparmor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8s工具集</title>
    <link href="/2020/08/06/%E9%98%BF%E9%87%8C%E4%BA%91%E5%AE%B9%E5%99%A8%E5%B9%B3%E5%8F%B0%E8%BF%90%E7%BB%B4-kubectl%E5%B7%A5%E5%85%B7%E9%9B%86/"/>
    <url>/2020/08/06/%E9%98%BF%E9%87%8C%E4%BA%91%E5%AE%B9%E5%99%A8%E5%B9%B3%E5%8F%B0%E8%BF%90%E7%BB%B4-kubectl%E5%B7%A5%E5%85%B7%E9%9B%86/</url>
    
    <content type="html"><![CDATA[<h6 id="集群切换、命名空间切换工具kubectlx-kubens"><a href="#集群切换、命名空间切换工具kubectlx-kubens" class="headerlink" title="集群切换、命名空间切换工具kubectlx, kubens"></a>集群切换、命名空间切换工具kubectlx, kubens</h6><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/ahmetb/</span>kubectx</code></pre><h6 id="Kubectl短命令集"><a href="#Kubectl短命令集" class="headerlink" title="Kubectl短命令集"></a>Kubectl短命令集</h6><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/ahmetb/</span>kubectl-aliases</code></pre><h6 id="命令行展示Kubernetes的集群名称和NS名称"><a href="#命令行展示Kubernetes的集群名称和NS名称" class="headerlink" title="命令行展示Kubernetes的集群名称和NS名称"></a>命令行展示Kubernetes的集群名称和NS名称</h6><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/jonmosco/</span>kube-ps1</code></pre><h6 id="K8S资源跟踪工具kubespy"><a href="#K8S资源跟踪工具kubespy" class="headerlink" title="K8S资源跟踪工具kubespy"></a>K8S资源跟踪工具kubespy</h6><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/pulumi/</span>kubespy</code></pre><h6 id="Kubectl-插件管理工具-krew"><a href="#Kubectl-插件管理工具-krew" class="headerlink" title="Kubectl 插件管理工具 krew"></a>Kubectl 插件管理工具 krew</h6><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/GoogleContainerTools/</span>krew</code></pre><h6 id="同时查看多个POD，或者一个pod中多个容器的log-stern"><a href="#同时查看多个POD，或者一个pod中多个容器的log-stern" class="headerlink" title="同时查看多个POD，或者一个pod中多个容器的log: stern"></a>同时查看多个POD，或者一个pod中多个容器的log: stern</h6><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/wercker/</span>stern</code></pre><h6 id="Docker-Image分析工具-dive"><a href="#Docker-Image分析工具-dive" class="headerlink" title="Docker Image分析工具: dive"></a>Docker Image分析工具: dive</h6><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/wagoodman/</span>dive</code></pre><h6 id="YAML编辑工具vscode"><a href="#YAML编辑工具vscode" class="headerlink" title="YAML编辑工具vscode"></a>YAML编辑工具vscode</h6><pre><code class="hljs awk">https:<span class="hljs-regexp">//</span>code.visualstudio.com/</code></pre><h6 id="Vscode编辑yaml的扩展插件"><a href="#Vscode编辑yaml的扩展插件" class="headerlink" title="Vscode编辑yaml的扩展插件"></a>Vscode编辑yaml的扩展插件</h6><pre><code class="hljs vim">http<span class="hljs-variable">s:</span>//marketplace.visualstudio.<span class="hljs-keyword">com</span>/<span class="hljs-built_in">items</span>?itemNam <span class="hljs-keyword">e</span>=redhat.vscode-yaml</code></pre>]]></content>
    
    
    <categories>
      
      <category>kubernetes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>k8s</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>kafka运维常用命令</title>
    <link href="/2020/08/05/kafka%E8%BF%90%E7%BB%B4%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/2020/08/05/kafka%E8%BF%90%E7%BB%B4%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<pre><code class="hljs brainfuck"><span class="hljs-comment">查看所有topics</span><span class="hljs-comment">bin/kafka</span><span class="hljs-literal">-</span><span class="hljs-comment">topics</span><span class="hljs-string">.</span><span class="hljs-comment">sh</span> --<span class="hljs-comment">zookeeper</span>  <span class="hljs-comment">localhost:2181</span> --<span class="hljs-comment">list</span><span class="hljs-comment"></span><span class="hljs-comment"></span><span class="hljs-comment">查看消费组</span><span class="hljs-comment">bin/kafka</span><span class="hljs-literal">-</span><span class="hljs-comment">consumer</span><span class="hljs-literal">-</span><span class="hljs-comment">groups</span><span class="hljs-string">.</span><span class="hljs-comment">sh</span> --<span class="hljs-comment">bootstrap</span><span class="hljs-literal">-</span><span class="hljs-comment">server</span> <span class="hljs-comment">localhost:9092</span> --<span class="hljs-comment">list</span><span class="hljs-comment"></span><span class="hljs-comment"></span><span class="hljs-comment">创建topic</span><span class="hljs-comment">bin/kafka</span><span class="hljs-literal">-</span><span class="hljs-comment">topics</span><span class="hljs-string">.</span><span class="hljs-comment">sh</span> --<span class="hljs-comment">create</span> --<span class="hljs-comment">zookeeper</span> <span class="hljs-comment">localhost:2181</span> --<span class="hljs-comment">replication</span><span class="hljs-literal">-</span><span class="hljs-comment">factor</span> <span class="hljs-comment">3</span> --<span class="hljs-comment">partitions</span> <span class="hljs-comment">6</span> --<span class="hljs-comment">topic</span> <span class="hljs-comment">test</span><span class="hljs-comment"></span><span class="hljs-comment"></span><span class="hljs-comment">查看topic</span> <span class="hljs-comment">分区副本状态</span><span class="hljs-comment">bin/kafka</span><span class="hljs-literal">-</span><span class="hljs-comment">topics</span><span class="hljs-string">.</span><span class="hljs-comment">sh</span> --<span class="hljs-comment">describe</span> --<span class="hljs-comment">zookeeper</span> <span class="hljs-comment">localhost:2181</span> --<span class="hljs-comment">topic</span> <span class="hljs-comment">test_event</span><span class="hljs-comment"></span><span class="hljs-comment"></span><span class="hljs-comment">扩分区，增加分区</span><span class="hljs-comment">bin/kafka</span><span class="hljs-literal">-</span><span class="hljs-comment">topics</span><span class="hljs-string">.</span><span class="hljs-comment">sh</span> --<span class="hljs-comment">alter</span> --<span class="hljs-comment">topic</span> <span class="hljs-comment">test_event</span> --<span class="hljs-comment">zookeeper</span> <span class="hljs-comment">localhost:1281</span> --<span class="hljs-comment">partitions</span> <span class="hljs-comment">12</span><span class="hljs-comment"></span><span class="hljs-comment"></span><span class="hljs-comment">查看某个消费组</span> <span class="hljs-comment">消费某个topic</span> <span class="hljs-comment">的情况</span><span class="hljs-comment"></span><span class="hljs-string">.</span><span class="hljs-comment">/bin/kafka</span><span class="hljs-literal">-</span><span class="hljs-comment">consumer</span><span class="hljs-literal">-</span><span class="hljs-comment">groups</span><span class="hljs-string">.</span><span class="hljs-comment">sh</span> --<span class="hljs-comment">new</span><span class="hljs-literal">-</span><span class="hljs-comment">consumer</span> --<span class="hljs-comment">bootstrap</span><span class="hljs-literal">-</span><span class="hljs-comment">server</span>  <span class="hljs-comment">localhost:9092</span> --<span class="hljs-comment">describe</span> --<span class="hljs-comment">group</span> <span class="hljs-comment">test_op|grep</span> <span class="hljs-comment">test_event</span><span class="hljs-comment"></span><span class="hljs-comment"></span><span class="hljs-comment">查看某个消费组</span> <span class="hljs-comment">消费某个topic</span> <span class="hljs-comment">的情况</span>  --<span class="hljs-comment">new</span><span class="hljs-literal">-</span><span class="hljs-comment">consumer新版本已移除</span><span class="hljs-comment">#bin/kafka</span><span class="hljs-literal">-</span><span class="hljs-comment">consumer</span><span class="hljs-literal">-</span><span class="hljs-comment">groups</span><span class="hljs-string">.</span><span class="hljs-comment">sh</span>  --<span class="hljs-comment">bootstrap</span><span class="hljs-literal">-</span><span class="hljs-comment">server</span> <span class="hljs-comment">127</span><span class="hljs-string">.</span><span class="hljs-comment">0</span><span class="hljs-string">.</span><span class="hljs-comment">0</span><span class="hljs-string">.</span><span class="hljs-comment">1:9092</span> --<span class="hljs-comment">describe</span> --<span class="hljs-comment">group</span> <span class="hljs-comment">test_op</span></code></pre>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>kafka</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>lsyncd实时同步神器</title>
    <link href="/2020/08/05/lsyncd%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E7%A5%9E%E5%99%A8/"/>
    <url>/2020/08/05/lsyncd%E5%AE%9E%E6%97%B6%E5%90%8C%E6%AD%A5%E7%A5%9E%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h6 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h6><pre><code class="hljs routeros">apt-<span class="hljs-builtin-name">get</span> install lsyncd</code></pre><h6 id="配置文件详解-cat-etc-lsyncd-lsyncd-lua"><a href="#配置文件详解-cat-etc-lsyncd-lsyncd-lua" class="headerlink" title="配置文件详解 cat /etc/lsyncd/lsyncd.lua"></a>配置文件详解 cat /etc/lsyncd/lsyncd.lua</h6><pre><code class="hljs nix">settings  &#123;    <span class="hljs-attr">logfile</span> = <span class="hljs-string">&quot;/var/log/lsyncd/lsyncd.log&quot;</span>, --定义日志文件    <span class="hljs-attr">statusFile</span> = <span class="hljs-string">&quot;/var/log/lsyncd/lsyncd.status&quot;</span>, --定义状态文件    <span class="hljs-attr">maxProcesses</span> = <span class="hljs-number">1</span> -- 同步进程的最大个数。假如同时有<span class="hljs-number">20</span>个文件需要同步，而<span class="hljs-attr">maxProcesses</span> = <span class="hljs-number">8</span>，则最大能看到有<span class="hljs-number">8</span>个rysnc进程&#125;sync &#123;        default.rsyncssh, --同步到远程主机目录，rsync的ssh模式，需要使用key来认证        <span class="hljs-attr">source</span> = <span class="hljs-string">&quot;/etc/nginx&quot;</span>, -- 同步的源目录，使用绝对路径        <span class="hljs-attr">host</span> = <span class="hljs-string">&quot;10.6.6.6&quot;</span>,        <span class="hljs-attr">targetdir</span> = <span class="hljs-string">&quot;/etc/nginx&quot;</span>, -- 定义目标目录        <span class="hljs-attr">init</span> = <span class="hljs-literal">false</span>, --这是一个优化选项，当<span class="hljs-attr">init</span> = <span class="hljs-literal">false</span>，只同步进程启动以后发生改动事件的文件，原有的目录即使有差异也不会同步。默认是<span class="hljs-literal">true</span>        <span class="hljs-attr">delay</span> = <span class="hljs-number">0</span>,<span class="hljs-attr">rsync</span>  = &#123;        <span class="hljs-attr">binary</span>    = <span class="hljs-string">&quot;/usr/bin/rsync&quot;</span>,        <span class="hljs-attr">archive</span>   = <span class="hljs-literal">true</span>,        <span class="hljs-attr">compress</span>  = <span class="hljs-literal">true</span>, --压缩传输默认为<span class="hljs-literal">true</span>。在带宽与cpu负载之间权衡，本地目录同步可以考虑把它设为<span class="hljs-literal">false</span>        <span class="hljs-attr">verbose</span>   = <span class="hljs-literal">true</span>&#125;, <span class="hljs-attr">ssh</span>   = &#123;        <span class="hljs-attr">port</span>  = <span class="hljs-number">22</span> <span class="hljs-comment">#ssh端口,目标机器需要做ssh免密</span>         &#125;&#125;</code></pre>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>lsyncd</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sysbench 测试 CPU性能测试详解</title>
    <link href="/2020/08/05/sysbench-%E6%B5%8B%E8%AF%95-CPU%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E8%AF%A6%E8%A7%A3/"/>
    <url>/2020/08/05/sysbench-%E6%B5%8B%E8%AF%95-CPU%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h6 id="sysbench安装"><a href="#sysbench安装" class="headerlink" title="sysbench安装"></a>sysbench安装</h6><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> sysbench</code></pre><h6 id="常用参数"><a href="#常用参数" class="headerlink" title="常用参数"></a>常用参数</h6><p>–cpu-max-prime: 素数生成数量的上限<br>–threads: 线程数<br>–time: 运行时长，单位秒<br>–events: event上限次数</p><h6 id="结果分析"><a href="#结果分析" class="headerlink" title="结果分析"></a>结果分析</h6><pre><code class="hljs sql">sysbench 1.0.17 (using system LuaJIT 2.0.4)Running the test <span class="hljs-keyword">with</span> <span class="hljs-keyword">following</span> options:<span class="hljs-built_in">Number</span> <span class="hljs-keyword">of</span> threads: <span class="hljs-number">2</span>  //指定线程数为<span class="hljs-number">2</span>Initializing random <span class="hljs-built_in">number</span> generator <span class="hljs-keyword">from</span> <span class="hljs-keyword">current</span> <span class="hljs-built_in">time</span>Prime numbers <span class="hljs-keyword">limit</span>: <span class="hljs-number">20000</span> //每个线程产生的素数上限均为<span class="hljs-number">2</span>万个Initializing worker threads...Threads started!CPU speed:    <span class="hljs-keyword">events</span> per <span class="hljs-keyword">second</span>:   <span class="hljs-number">662.99</span> // 所有线程每秒完成了<span class="hljs-number">662.99</span>次<span class="hljs-keyword">event</span><span class="hljs-keyword">General</span> <span class="hljs-keyword">statistics</span>:    total <span class="hljs-built_in">time</span>:                          <span class="hljs-number">10.0012</span>s     // 共耗时<span class="hljs-number">10</span>秒    total <span class="hljs-built_in">number</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">events</span>:              <span class="hljs-number">6632</span>  // <span class="hljs-number">10</span>秒内所有线程一共完成了<span class="hljs-number">6632</span>次<span class="hljs-keyword">event</span>Latency (ms):         <span class="hljs-keyword">min</span>:                                    <span class="hljs-number">3.01</span> // 完成<span class="hljs-number">1</span>次<span class="hljs-keyword">event</span>的最少耗时         <span class="hljs-keyword">avg</span>:                                    <span class="hljs-number">3.02</span> // 所有<span class="hljs-keyword">event</span>的平均耗时         <span class="hljs-keyword">max</span>:                                    <span class="hljs-number">3.09</span> // 完成<span class="hljs-number">1</span>次<span class="hljs-keyword">event</span>的最多耗时<span class="hljs-number">95</span>th percentile:                        <span class="hljs-number">3.02</span> // <span class="hljs-number">95</span>%次<span class="hljs-keyword">event</span>在<span class="hljs-number">3.02</span>秒毫秒内完成         <span class="hljs-keyword">sum</span>:                                <span class="hljs-number">19998.23</span>  // 每个线程耗时<span class="hljs-number">10</span>秒，<span class="hljs-number">2</span>个线程叠加耗时就是<span class="hljs-number">20</span>秒Threads fairness:    <span class="hljs-keyword">events</span> (<span class="hljs-keyword">avg</span>/<span class="hljs-keyword">stddev</span>):           <span class="hljs-number">3316.0000</span>/<span class="hljs-number">0.00</span> // 平均每个线程完成<span class="hljs-number">3316</span>次<span class="hljs-keyword">event</span>，标准差为<span class="hljs-number">0</span>    execution <span class="hljs-built_in">time</span> (<span class="hljs-keyword">avg</span>/<span class="hljs-keyword">stddev</span>):   <span class="hljs-number">9.9991</span>/<span class="hljs-number">0.00</span>  // 每个线程平均耗时<span class="hljs-number">9.9</span>秒，标准差为<span class="hljs-number">0</span>如果有<span class="hljs-number">2</span>台服务器进行CPU性能对比，当素数上限和线程数一致时：相同时间，比较<span class="hljs-keyword">event</span>相同<span class="hljs-keyword">event</span>，比较时间时间和<span class="hljs-keyword">event</span>都相同，比较<span class="hljs-keyword">stddev</span>(标准差)</code></pre>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cpu</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>io测试工具fio使用</title>
    <link href="/2020/08/05/io%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7fio%E4%BD%BF%E7%94%A8/"/>
    <url>/2020/08/05/io%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7fio%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h6 id="fio是一个测试iops的工具，用来对硬件进行压力测试和验证，支持13种不同的I-O引擎，包括-sync-mmap-libaio-posixaio-SGv3-splice-null-network-syslet-guasi-solarisaio等等"><a href="#fio是一个测试iops的工具，用来对硬件进行压力测试和验证，支持13种不同的I-O引擎，包括-sync-mmap-libaio-posixaio-SGv3-splice-null-network-syslet-guasi-solarisaio等等" class="headerlink" title="fio是一个测试iops的工具，用来对硬件进行压力测试和验证，支持13种不同的I/O引擎，包括:sync,mmap,libaio,posixaio,SGv3,splice,null,network,syslet,guasi,solarisaio等等"></a>fio是一个测试iops的工具，用来对硬件进行压力测试和验证，支持13种不同的I/O引擎，包括:sync,mmap,libaio,posixaio,SGv3,splice,null,network,syslet,guasi,solarisaio等等</h6><pre><code class="hljs awk">github地址 ：https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/axboe/</span>fio</code></pre><h5 id="fio使用"><a href="#fio使用" class="headerlink" title="fio使用"></a>fio使用</h5><h6 id="通过使用Fio-Job-file-configuration-来编辑好，我们要测试的具体参数值。通过命令-fio-fio-cfg-开始测试"><a href="#通过使用Fio-Job-file-configuration-来编辑好，我们要测试的具体参数值。通过命令-fio-fio-cfg-开始测试" class="headerlink" title="通过使用Fio Job file (configuration) 来编辑好，我们要测试的具体参数值。通过命令 fio fio.cfg 开始测试"></a>通过使用Fio Job file (configuration) 来编辑好，我们要测试的具体参数值。通过命令 fio fio.cfg 开始测试</h6><pre><code class="hljs routeros">$ cat fio.cfg[global]<span class="hljs-attribute">filename</span>=/dev/sdb<span class="hljs-attribute">direct</span>=1<span class="hljs-attribute">ioengine</span>=libaiotime_based<span class="hljs-attribute">runtime</span>=600<span class="hljs-attribute">iodepth</span>=4refill_buffersgroup_reportingwait_for_previous<span class="hljs-attribute">ramp_time</span>=5[JOB1]<span class="hljs-attribute">bs</span>=4k<span class="hljs-attribute">rw</span>=read[JOB2]<span class="hljs-attribute">bs</span>=32k<span class="hljs-attribute">rw</span>=read[JOB3]<span class="hljs-attribute">bs</span>=4k<span class="hljs-attribute">rw</span>=randread[JOB4]<span class="hljs-attribute">bs</span>=32k<span class="hljs-attribute">rw</span>=randread$ sudo fio fio.cfg | tee /tmp/fiotest.log</code></pre><h5 id="配置参数说明"><a href="#配置参数说明" class="headerlink" title="配置参数说明"></a>配置参数说明</h5><pre><code class="hljs routeros"><span class="hljs-attribute">filename</span>=/dev/sdb        测试文件名称，通常选择需要测试的盘的data目录，做写测试的时候需要换成对应的/data/fioxxx要不然磁盘全盘随机写之后系统将不可用<span class="hljs-attribute">direct</span>=1                 测试过程绕过机器自带的buffer。使测试结果更真实。<span class="hljs-attribute">rw</span>=randwrite             测试随机写的I/O<span class="hljs-attribute">rw</span>=randrw                测试随机写和读的I/O<span class="hljs-attribute">bs</span>=4k                    单次io的块文件大小为16k<span class="hljs-attribute">bsrange</span>=512-2048         同上，提定数据块的大小范围，参考配置<span class="hljs-attribute">size</span>=5g                      本次的测试文件大小为5g，以每次4k的io进行测试。没有写默认为100%，写100%测试结果更真实<span class="hljs-attribute">numjobs</span>=4                本次的测试线程为4 这个参数的设定跟队列深度一样 会影响测试结果<span class="hljs-attribute">runtime</span>=600              测试时间为600秒，如果不写则一直将5g文件分4k每次写完为止。<span class="hljs-attribute">ioengine</span>=libaio          io引擎使用pync方式<span class="hljs-attribute">rwmixwrite</span>=30            在混合读写的模式下，写占30%group_reporting          关于显示结果的，汇总每个进程的信息。refill_buffers           为预设值跟I/O Buffer有关(refill the IO buffers on every submit),把Buffer跑慢之后就不会再跑到Buffer的值wait_for_previous        预设所有的job会一起执行，这个参数，可以让所有的job依次执行iodepth                  队列深度，就是一把喂给设备多少的iotime_based               测试以时间为单位，另外一种方式是以kb_baseramp_time                设定ramp_time会让开始测试的一段时间不统计到整体里面，避免测试是跑在cache里面的</code></pre>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>io</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>openfalcon报警触发函数</title>
    <link href="/2020/08/05/openfalcon%E6%8A%A5%E8%AD%A6%E8%A7%A6%E5%8F%91%E5%87%BD%E6%95%B0/"/>
    <url>/2020/08/05/openfalcon%E6%8A%A5%E8%AD%A6%E8%A7%A6%E5%8F%91%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<pre><code class="hljs angelscript">all(#<span class="hljs-number">3</span>): 最新的<span class="hljs-number">3</span>个点都满足阈值条件则报警max(#<span class="hljs-number">3</span>): 对于最新的<span class="hljs-number">3</span>个点，其最大值满足阈值条件则报警min(#<span class="hljs-number">3</span>): 对于最新的<span class="hljs-number">3</span>个点，其最小值满足阈值条件则报警sum(#<span class="hljs-number">3</span>): 对于最新的<span class="hljs-number">3</span>个点，其和满足阈值条件则报警avg(#<span class="hljs-number">3</span>): 对于最新的<span class="hljs-number">3</span>个点，其平均值满足阈值条件则报警diff(#<span class="hljs-number">3</span>): 拿最新push上来的点（被减数），与历史最新的<span class="hljs-number">3</span>个点（<span class="hljs-number">3</span>个减数）相减，得到<span class="hljs-number">3</span>个差，只要有一个差满足阈值条件则报警pdiff(#<span class="hljs-number">3</span>): 拿最新push上来的点，与历史最新的<span class="hljs-number">3</span>个点相减，得到<span class="hljs-number">3</span>个差，再将<span class="hljs-number">3</span>个差值分别除以减数，得到<span class="hljs-number">3</span>个商值，只要有一个商值满足阈值则报警   lookup(#<span class="hljs-number">3</span>,<span class="hljs-number">2</span>): 最新的<span class="hljs-number">3</span>个点中有两个满足条件则报警</code></pre>]]></content>
    
    
    <categories>
      
      <category>监控</category>
      
    </categories>
    
    
    <tags>
      
      <tag>openfalcon</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>openfalcon报警策略中diff和pdiff对比</title>
    <link href="/2020/08/05/openfalcon%E6%8A%A5%E8%AD%A6%E7%AD%96%E7%95%A5%E4%B8%ADdiff%E5%92%8Cpdiff%E5%AF%B9%E6%AF%94/"/>
    <url>/2020/08/05/openfalcon%E6%8A%A5%E8%AD%A6%E7%AD%96%E7%95%A5%E4%B8%ADdiff%E5%92%8Cpdiff%E5%AF%B9%E6%AF%94/</url>
    
    <content type="html"><![CDATA[<p>falcon的告警策略中，为了满足对突增、突降流量的告警，提供了diff和pdiff的表达式</p><pre><code class="hljs"><span class="hljs-attribute">diff(#3)</span>: 拿最新push上来的点（被减数），与历史最新的3个点（3个减数）相减，得到3个差，只要有一个差满足阈值条件则报警<span class="hljs-attribute">pdiff(#3)</span>: 拿最新push上来的点，与历史最新的3个点相减，得到3个差，再将3个差值分别除以减数，得到3个商值，只要有一个商值满足阈值则报警设计diff和pdiff是为了监控流量突增突降报警，其中pdiff是按照百分比方式进行对比。 源码：https://github.com/open-falcon/judge/blob/master/store/func.go</code></pre><h5 id="diff和pdiff的使用示例："><a href="#diff和pdiff的使用示例：" class="headerlink" title="diff和pdiff的使用示例："></a>diff和pdiff的使用示例：</h5><pre><code class="hljs angelscript">diff(#<span class="hljs-number">3</span>): 拿最新push上来的点（被减数），与历史最新的<span class="hljs-number">3</span>个点（<span class="hljs-number">3</span>个减数）相减，得到<span class="hljs-number">3</span>个差，只要有一个差满足阈值条件则报警公式：d2 - d1注意：d2小于d1的时候会出现负值比方说数据是每分钟上报一个点，当前时间是<span class="hljs-number">2016</span><span class="hljs-number">-03</span><span class="hljs-number">-24</span> <span class="hljs-number">10</span>:<span class="hljs-number">04</span>:<span class="hljs-number">00</span>，上报的数据点的值为d4=<span class="hljs-number">100</span>，<span class="hljs-number">10</span>:<span class="hljs-number">03</span>:<span class="hljs-number">00</span>上报的数据点为d3=<span class="hljs-number">80</span>，<span class="hljs-number">10</span>:<span class="hljs-number">02</span>:<span class="hljs-number">00</span>上报的数据点为d2=<span class="hljs-number">60</span>，<span class="hljs-number">10</span>:<span class="hljs-number">01</span>:<span class="hljs-number">00</span>上报的数据点为d1=<span class="hljs-number">40</span>，diff(#<span class="hljs-number">3</span>)表示的函义就是d4分别减去d3/d2/d1，得到的三个值<span class="hljs-number">20</span>/<span class="hljs-number">40</span>/<span class="hljs-number">60</span>只要有一个值满足阈值条件都会报警。</code></pre><pre><code class="hljs angelscript">pdiff(#<span class="hljs-number">3</span>): 拿最新push上来的点，与历史最新的<span class="hljs-number">3</span>个点相减，得到<span class="hljs-number">3</span>个差，再将<span class="hljs-number">3</span>个差值分别除以减数，得到<span class="hljs-number">3</span>个商值，只要有一个商值满足阈值则报警。公式：(d2 - d1)/d1*<span class="hljs-number">100.0</span>注意：d2小于d1的时候会出现负值还以上述数据上报为例，d4分别减去d3/d2/d1，得到三个差值：<span class="hljs-number">20</span>/<span class="hljs-number">40</span>/<span class="hljs-number">60</span>，每个差值分别除以对应的减数d3/d2/d1，再乘以<span class="hljs-number">100.0</span>，得到<span class="hljs-number">3</span>个商值：<span class="hljs-number">25.0</span>/<span class="hljs-number">66.67</span>/<span class="hljs-number">150.0</span>，只要有一个商值满足阈值则报警。</code></pre>]]></content>
    
    
    <categories>
      
      <category>监控</category>
      
    </categories>
    
    
    <tags>
      
      <tag>openfalcon</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>tcpdump抓包</title>
    <link href="/2020/08/05/tcpdump/"/>
    <url>/2020/08/05/tcpdump/</url>
    
    <content type="html"><![CDATA[<h5 id="只获取GET请求："><a href="#只获取GET请求：" class="headerlink" title="只获取GET请求："></a>只获取GET请求：</h5><pre><code class="hljs apache"><span class="hljs-attribute">port</span> <span class="hljs-number">80</span> and (tcp[<span class="hljs-number">32</span>:<span class="hljs-number">4</span>] - <span class="hljs-number">0</span>x<span class="hljs-number">47455420</span> = <span class="hljs-number">0</span>)</code></pre><h5 id="只获取POST请求："><a href="#只获取POST请求：" class="headerlink" title="只获取POST请求："></a>只获取POST请求：</h5><pre><code class="hljs apache"><span class="hljs-attribute">port</span> <span class="hljs-number">80</span> and (tcp[<span class="hljs-number">32</span>:<span class="hljs-number">4</span>] - <span class="hljs-number">0</span>x<span class="hljs-number">504</span>F<span class="hljs-number">5354</span> = <span class="hljs-number">0</span>)</code></pre><h5 id="获取第一个http响应数据包："><a href="#获取第一个http响应数据包：" class="headerlink" title="获取第一个http响应数据包："></a>获取第一个http响应数据包：</h5><pre><code class="hljs apache"><span class="hljs-attribute">port</span> <span class="hljs-number">80</span> and (tcp[<span class="hljs-number">32</span>:<span class="hljs-number">6</span>] - <span class="hljs-number">0</span>x<span class="hljs-number">485454502</span>f<span class="hljs-number">31</span> = <span class="hljs-number">0</span>)<span class="hljs-attribute">port</span> <span class="hljs-number">80</span> and ((tcp[<span class="hljs-number">32</span>:<span class="hljs-number">4</span>] - <span class="hljs-number">0</span>x<span class="hljs-number">47455420</span> = <span class="hljs-number">0</span>) or (tcp[<span class="hljs-number">32</span>:<span class="hljs-number">4</span>] - <span class="hljs-number">0</span>x<span class="hljs-number">504</span>F<span class="hljs-number">5354</span> = <span class="hljs-number">0</span>) or (tcp[<span class="hljs-number">32</span>:<span class="hljs-number">6</span>] - <span class="hljs-number">0</span>x<span class="hljs-number">485454502</span>f<span class="hljs-number">31</span> = <span class="hljs-number">0</span>))</code></pre><h5 id="获取所有HTTP请求（不包含syn，ack等，也就是有数据的tcp）："><a href="#获取所有HTTP请求（不包含syn，ack等，也就是有数据的tcp）：" class="headerlink" title="获取所有HTTP请求（不包含syn，ack等，也就是有数据的tcp）："></a>获取所有HTTP请求（不包含syn，ack等，也就是有数据的tcp）：</h5><pre><code class="hljs apache"><span class="hljs-attribute">tcp</span> port <span class="hljs-number">80</span> and (((ip[<span class="hljs-number">2</span>:<span class="hljs-number">2</span>] - ((ip[<span class="hljs-number">0</span>]&amp;<span class="hljs-number">0</span>xf)&lt;&lt;<span class="hljs-number">2</span>)) - ((tcp[<span class="hljs-number">12</span>]&amp;<span class="hljs-number">0</span>xf<span class="hljs-number">0</span>)&gt;&gt;<span class="hljs-number">2</span>)) != <span class="hljs-number">0</span>)</code></pre>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>tcpdump</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
